<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Luqy Store</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-50 min-h-screen">

<header class="bg-gradient-to-r from-pink-400 to-rose-500 text-white p-6 text-center shadow">
  <h1 class="text-3xl font-extrabold">Admin Luqy Store</h1>
</header>

<div class="max-w-4xl mx-auto p-6">

  <!-- LOGIN -->
  <div id="loginBox" class="bg-white p-6 rounded-xl shadow">
    <h2 class="text-xl font-bold mb-4 text-pink-600">Login Admin</h2>
    <input id="email" type="email" placeholder="Email" class="w-full border p-2 rounded mb-2"/>
    <input id="password" type="password" placeholder="Password" class="w-full border p-2 rounded mb-4"/>
    <button id="loginBtn" class="w-full bg-pink-500 text-white p-2 rounded-full mb-2 hover:bg-pink-600 transition">Login</button>
    <button id="resetBtn" class="text-sm text-pink-500 underline w-full mb-2 hover:text-pink-600">Lupa password?</button>
    <button id="backToVisitor" class="w-full border border-pink-400 text-pink-500 p-2 rounded-full hover:bg-pink-50 transition">â† Kembali ke Luqy Store</button>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="hidden">

    <button id="logoutBtn" class="mb-4 bg-rose-500 text-white px-4 py-2 rounded-full hover:bg-rose-600 transition">Logout</button>

    <!-- TAMBAH / EDIT PRODUK -->
    <div class="bg-white p-6 rounded-xl shadow mb-6">
      <h2 class="font-bold mb-4">Tambah / Edit Produk</h2>
      <input id="nama" placeholder="Nama Produk *" class="w-full border p-2 rounded mb-2"/>
      <textarea id="deskripsi" placeholder="Deskripsi" class="w-full border p-2 rounded mb-2"></textarea>
      <input id="link" placeholder="Link Affiliate *" class="w-full border p-2 rounded mb-2"/>
      <input id="gambar" placeholder="URL Gambar" class="w-full border p-2 rounded mb-2"/>
      <select id="kategori" class="w-full border p-2 rounded mb-4">
        <option value="">Pilih Kategori *</option>
        <option value="skincare">ğŸ’„ Skincare</option>
        <option value="fashion">ğŸ‘œ Fashion</option>
        <option value="home">ğŸ  Home & Living</option>
      </select>
      <button id="simpanBtn" class="w-full bg-pink-500 text-white p-2 rounded-full hover:bg-pink-600 transition">Simpan Produk</button>
    </div>

    <!-- DAFTAR PRODUK -->
    <div id="produkList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAgvqSOqTr5zeGFArOWYSaUExCAlwEw2gE",
  authDomain: "luqqy-store.firebaseapp.com",
  projectId: "luqqy-store",
  storageBucket: "luqqy-store.firebasestorage.app",
  messagingSenderId: "157194853674",
  appId: "1:157194853674:web:936fac43307d852fedd253",
  measurementId: "G-934QRS9WKR"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* ELEMENT */
const loginBox = document.getElementById("loginBox");
const dashboard = document.getElementById("dashboard");
const produkList = document.getElementById("produkList");

const email = document.getElementById("email");
const password = document.getElementById("password");
const nama = document.getElementById("nama");
const deskripsi = document.getElementById("deskripsi");
const link = document.getElementById("link");
const gambar = document.getElementById("gambar");
const kategori = document.getElementById("kategori");

let editId = null;

/* LOGIN */
loginBtn.onclick = () => {
  signInWithEmailAndPassword(auth,email.value,password.value)
    .catch(err=>alert("Login gagal: "+err.message));
};

/* RESET PASSWORD */
resetBtn.onclick = () => {
  if(!email.value) return alert("Masukkan email");
  sendPasswordResetEmail(auth,email.value).then(()=>alert("ğŸ“§ Email reset terkirim"));
};

/* BACK TO VISITOR */
backToVisitor.onclick = () => location.href="index.html";

/* LOGOUT */
logoutBtn.onclick = async()=>{ await signOut(auth); location.href="index.html"; };

/* AUTH STATE */
onAuthStateChanged(auth,user=>{
  if(user){ loginBox.classList.add("hidden"); dashboard.classList.remove("hidden"); loadProdukAdmin(); }
  else{ loginBox.classList.remove("hidden"); dashboard.classList.add("hidden"); }
});

/* SIMPAN / EDIT PRODUK */
simpanBtn.onclick = async()=>{
  if(!nama.value || !link.value || !kategori.value){
    alert("âŒ Nama, Link & Kategori wajib diisi");
    return;
  }

  try{
    if(editId){
      await updateDoc(doc(db,"produk",editId), {
        nama: nama.value,
        deskripsi: deskripsi.value,
        link: link.value,
        gambar: gambar.value,
        kategori: kategori.value
      });
      alert("âœ… Produk berhasil diupdate");
      editId = null;
    }else{
      await addDoc(collection(db,"produk"), {
        nama: nama.value,
        deskripsi: deskripsi.value,
        link: link.value,
        gambar: gambar.value,
        kategori: kategori.value,
        klik: 0,
        createdAt: serverTimestamp()
      });
      alert("âœ… Produk berhasil disimpan");
    }

    // Reset form
    nama.value = deskripsi.value = link.value = gambar.value = kategori.value = "";
    loadProdukAdmin();
  }catch(e){ alert("âŒ Gagal simpan: "+e.message);}
};

/* LOAD PRODUK ADMIN */
async function loadProdukAdmin(){
  produkList.innerHTML="";
  const snap = await getDocs(collection(db,"produk"));
  const kategoriMap = {};
  snap.forEach(d=>{
    const p=d.data();
    if(!kategoriMap[p.kategori]) kategoriMap[p.kategori]=[];
    kategoriMap[p.kategori].push({id:d.id,...p});
  });

  Object.keys(kategoriMap).forEach(cat=>{
    const section=document.createElement("details");
    section.className="mb-6";
    section.innerHTML=`<summary class="cursor-pointer font-bold text-xl text-pink-600 mb-4">${cat}</summary><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>`;
    const grid=section.querySelector("div");

    kategoriMap[cat].forEach(p=>{
      const card=document.createElement("div");
      card.className="bg-white rounded-2xl shadow p-4";
      card.innerHTML=`
        <div class="overflow-hidden rounded-xl mb-2 bg-pink-100">
          <img src="${p.gambar||'https://via.placeholder.com/400x400?text=Luqy+Store'}" class="w-full h-40 object-cover"/>
        </div>
        <b>${p.nama}</b>
        <p class="text-sm text-gray-500 mb-2">${p.deskripsi||''}</p>
        <p class="text-xs text-gray-400 mb-2">Klik: ${p.klik||0}</p>
        <div class="flex justify-between mt-2">
          <button class="viewBtn bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600 transition">View</button>
          <button class="editBtn bg-yellow-400 text-white px-3 py-1 rounded-full hover:bg-yellow-500 transition">Edit</button>
          <button class="hapusBtn bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600 transition">Hapus</button>
        </div>
      `;

      // HAPUS
      card.querySelector(".hapusBtn").onclick=async()=>{
        if(confirm("Hapus produk?")){
          await deleteDoc(doc(db,"produk",p.id));
          loadProdukAdmin();
        }
      };

      // EDIT
      card.querySelector(".editBtn").onclick=()=>{
        editId = p.id;
        nama.value = p.nama;
        deskripsi.value = p.deskripsi;
        link.value = p.link;
        gambar.value = p.gambar;
        kategori.value = p.kategori;
        window.scrollTo({top:0, behavior:"smooth"});
      };

      // VIEW
      card.querySelector(".viewBtn").onclick=()=>{
        window.open(p.link,"_blank");
      };

      grid.appendChild(card);
    });
    produkList.appendChild(section);
  });
}
</script>
</body>
</html>
