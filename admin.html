<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Luqy Store</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-pink-50 min-h-screen">

<header class="bg-gradient-to-r from-pink-400 to-rose-500 text-white p-6 text-center shadow">
  <h1 class="text-3xl font-extrabold">Admin Luqy Store</h1>
</header>

<div class="max-w-5xl mx-auto p-6">

<!-- LOGIN -->
<div id="loginBox" class="bg-white p-6 rounded-xl shadow">
  <input id="email" placeholder="Email" class="w-full border p-2 rounded mb-2">
  <input id="password" type="password" placeholder="Password" class="w-full border p-2 rounded mb-4">
  <button id="loginBtn" class="w-full bg-pink-500 text-white p-2 rounded-full">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

<button id="logoutBtn" class="mb-4 bg-rose-500 text-white px-4 py-2 rounded-full">Logout</button>

<div class="bg-white p-6 rounded-xl shadow mb-6">
  <input id="nama" placeholder="Nama Produk *" class="w-full border p-2 rounded mb-2">
  <textarea id="deskripsi" placeholder="Deskripsi" class="w-full border p-2 rounded mb-2"></textarea>
  <input id="link" placeholder="Link Produk *" class="w-full border p-2 rounded mb-2">
  <input id="gambar" placeholder="URL Gambar" class="w-full border p-2 rounded mb-2">
  <select id="kategori" class="w-full border p-2 rounded mb-4">
    <option value="">Pilih Kategori *</option>
    <option value="skincare">Skincare</option>
    <option value="fashion">Fashion</option>
    <option value="home">Home</option>
  </select>
  <button id="simpanBtn" class="w-full bg-pink-500 text-white p-2 rounded-full">Simpan</button>
</div>

<input id="adminSearch" placeholder="ðŸ” Cari produk..."
 class="w-full mb-4 p-3 rounded-full border">

<div id="produkList"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgvqSOqTr5zeGFArOWYSaUExCAlwEw2gE",
  authDomain: "luqqy-store.firebaseapp.com",
  projectId: "luqqy-store",
  appId: "1:157194853674:web:936fac43307d852fedd253"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const loginBox = document.getElementById("loginBox");
const dashboard = document.getElementById("dashboard");
const produkList = document.getElementById("produkList");
const adminSearch = document.getElementById("adminSearch");

let editId = null;
let cache = [];

/* AUTH */
loginBtn.onclick=()=>signInWithEmailAndPassword(auth,email.value,password.value);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,u=>{
  if(u){ loginBox.classList.add("hidden"); dashboard.classList.remove("hidden"); loadAdmin(); }
  else{ loginBox.classList.remove("hidden"); dashboard.classList.add("hidden"); }
});

/* SAVE */
simpanBtn.onclick=async()=>{
  if(!nama.value||!link.value||!kategori.value) return alert("Field wajib kosong");

  const data={
    nama:nama.value,
    deskripsi:deskripsi.value,
    link:link.value,
    gambar:gambar.value,
    kategori:kategori.value,
    klik:0,
    createdAt:serverTimestamp()
  };

  editId
    ? await updateDoc(doc(db,"produk",editId),data)
    : await addDoc(collection(db,"produk"),data);

  editId=null;
  nama.value=deskripsi.value=link.value=gambar.value=kategori.value="";
  loadAdmin();
};

/* LOAD ADMIN */
async function loadAdmin(){
  produkList.innerHTML="";
  cache=[];
  const snap=await getDocs(collection(db,"produk"));
  snap.forEach(d=>cache.push({id:d.id,...d.data()}));
  renderAdmin(cache);
}

function renderAdmin(data){
  produkList.innerHTML="";
  const key=adminSearch.value.toLowerCase();
  data.filter(p=>p.nama.toLowerCase().includes(key)).forEach(p=>{
    const div=document.createElement("div");
    div.className="bg-white p-4 rounded-xl shadow mb-3";
    div.innerHTML=`
      <b>${p.nama}</b> â€¢ Klik: ${p.klik||0}
      <div class="flex gap-2 mt-2">
        <button class="edit bg-yellow-400 px-3 py-1 rounded">Edit</button>
        <button class="del bg-red-500 text-white px-3 py-1 rounded">Hapus</button>
        <button class="view bg-blue-500 text-white px-3 py-1 rounded">View</button>
      </div>
    `;
    div.querySelector(".edit").onclick=()=>{ editId=p.id; nama.value=p.nama; deskripsi.value=p.deskripsi; link.value=p.link; gambar.value=p.gambar; kategori.value=p.kategori; };
    div.querySelector(".del").onclick=()=>deleteDoc(doc(db,"produk",p.id)).then(loadAdmin);
    div.querySelector(".view").onclick=()=>window.open(p.link,"_blank");
    produkList.appendChild(div);
  });
}

adminSearch.addEventListener("input",()=>renderAdmin(cache));
</script>
</body>
</html>
