<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Luqqy Store</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-50 min-h-screen">


<header class="bg-gradient-to-r from-pink-400 to-rose-500 text-white p-6 text-center shadow">
<h1 class="text-3xl font-extrabold">Admin Luqqy Store</h1>
</header>


<div class="max-w-4xl mx-auto p-6">


<!-- LOGIN -->
<div id="loginBox" class="bg-white p-6 rounded-xl shadow">
<h2 class="text-xl font-bold mb-4 text-pink-600">Login Admin</h2>
<input id="email" type="email" placeholder="Email" class="w-full border p-2 rounded mb-2" />
<input id="password" type="password" placeholder="Password" class="w-full border p-2 rounded mb-4" />
<button id="loginBtn" class="w-full bg-pink-500 text-white p-2 rounded-full mb-2">Login</button>
<button onclick="resetPassword()" class="text-sm text-pink-500 underline w-full">Lupa password?</button>
</div>


<!-- DASHBOARD -->
<div id="dashboard" class="hidden">


<button onclick="logout()" class="mb-4 bg-rose-500 text-white px-4 py-2 rounded-full">Logout</button>


<div class="bg-white p-6 rounded-xl shadow mb-6">
<h2 class="font-bold mb-4">Tambah / Edit Produk</h2>
<input id="nama" placeholder="Nama Produk" class="w-full border p-2 rounded mb-2">
<textarea id="deskripsi" placeholder="Deskripsi" class="w-full border p-2 rounded mb-2"></textarea>
<input id="gambar" placeholder="URL Gambar" class="w-full border p-2 rounded mb-2">
<input id="link" placeholder="Link Affiliate" class="w-full border p-2 rounded mb-2">


<select id="kategori" class="w-full border p-2 rounded mb-4">
<option value="">Pilih Kategori</option>
<option value="skincare">ğŸ’„ Skincare</option>
<option value="fashion">ğŸ‘œ Fashion</option>
<option value="home">ğŸ  Home</option>
</select>


<button onclick="simpan()" class="w-full bg-pink-500 text-white p-2 rounded-full">Simpan</button>
</div>


<div id="list"></div>
</div>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc,
  updateDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import {
  getAuth,
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgvqSOqTr5zeGFArOWYSaUExCAlwEw2gE",
  authDomain: "luqqy-store.firebaseapp.com",
  projectId: "luqqy-store",
  storageBucket: "luqqy-store.firebasestorage.app",
  messagingSenderId: "157194853674",
  appId: "1:157194853674:web:936fac43307d852fedd253",
  measurementId: "G-934QRS9WKR"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ================= LOGIN =================
const login = () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
    .catch(err => {
      if (err.code === "auth/wrong-password") {
        alert("âŒ Password salah");
      } else if (err.code === "auth/user-not-found") {
        alert("âŒ Email tidak terdaftar");
      } else if (err.code === "auth/invalid-email") {
        alert("âŒ Email tidak valid");
      } else {
        alert("Login gagal: " + err.message);
      }
    });
};

document.getElementById("loginBtn").addEventListener("click", login);

// ================= RESET PASSWORD =================
window.resetPassword = () => {
  if (!email.value) {
    alert("Masukkan email dulu");
    return;
  }
  sendPasswordResetEmail(auth, email.value)
    .then(() => alert("ğŸ“§ Link reset password dikirim ke email"))
    .catch(err => alert(err.message));
};

// ================= LOGOUT =================
window.logout = () => signOut(auth);

// ================= AUTH STATE =================
onAuthStateChanged(auth, user => {
  if (user) {
    loginBox.classList.add("hidden");
    dashboard.classList.remove("hidden");
    loadProduk();
  } else {
    loginBox.classList.remove("hidden");
    dashboard.classList.add("hidden");
  }
});

// ================= PRODUK =================
async function loadProduk() {
  const snap = await getDocs(collection(db, "produk"));
  list.innerHTML = "";
  snap.forEach(d => {
    const p = d.data();
    list.innerHTML += `
      <div class="bg-white p-4 rounded-xl shadow mb-3">
        <b>${p.nama}</b>
        <button onclick="hapus('${d.id}')" class="ml-3 text-sm text-red-500">Hapus</button>
      </div>`;
  });
}

window.simpan = async () => {
  await addDoc(collection(db, "produk"), {
    nama: nama.value,
    deskripsi: deskripsi.value,
    gambar: gambar.value,
    link: link.value,
    kategori: kategori.value,
    klik: 0,
    createdAt: serverTimestamp()
  });
  nama.value = deskripsi.value = gambar.value = link.value = kategori.value = "";
  loadProduk();
};

window.hapus = async id => {
  if (confirm("Hapus produk?")) {
    await deleteDoc(doc(db, "produk", id));
    loadProduk();
  }
};
</script>

const firebaseConfig = {
apiKey: "AIzaSyAgvqSOqTr5zeGFArOWYSaUExCAlwEw2gE",
authDomain: "luqqy-store.firebaseapp.com",
projectId: "luqqy-store",
storageBucket: "luqqy-store.firebasestorage.app",
messagingSenderId: "157194853674",
appId: "1:157194853674:web:936fac43307d852fedd253",
measurementId: "G-934QRS9WKR"
};


const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);


let produk = [];
let editId = null;


const login = () => {
signInWithEmailAndPassword(auth, email.value, password.value)
.catch(err => {
if (err.code === 'auth/wrong-password') {
alert('âŒ Password salah. Silakan coba lagi');
} else if (err.code === 'auth/user-not-found') {
alert('âŒ Email tidak terdaftar');
} else if (err.code === 'auth/invalid-email') {
alert('âŒ Format email tidak valid');
} else {
alert('Login gagal: ' + err.message);
}
</html>
