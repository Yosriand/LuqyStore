<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Luqqy Store</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-50 min-h-screen">

<header class="bg-gradient-to-r from-pink-400 to-rose-500 text-white p-6 shadow flex justify-between items-center">
  <h1 class="text-3xl font-extrabold">Luqqy Store</h1>
  <a href="admin.html" class="bg-white text-pink-500 px-4 py-2 rounded-full text-sm font-semibold hover:bg-pink-100 transition">
    ğŸ” Login Admin
  </a>
</header>

<div class="max-w-6xl mx-auto p-6">
  <input id="search" placeholder="ğŸ” Cari produk..." class="flex-1 p-3 rounded-full border mb-4"/>
  <select id="sort" class="p-3 rounded-full border mb-6">
    <option value="terbaru">ğŸ†• Terbaru</option>
    <option value="terlaris">ğŸ”¥ Terlaris</option>
  </select>
  <div id="produk"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, increment, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgvqSOqTr5zeGFArOWYSaUExCAlwEw2gE",
  authDomain: "luqqy-store.firebaseapp.com",
  projectId: "luqqy-store",
  storageBucket: "luqqy-store.firebasestorage.app",
  messagingSenderId: "157194853674",
  appId: "1:157194853674:web:936fac43307d852fedd253"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const produkEl = document.getElementById("produk");
const searchEl = document.getElementById("search");
const sortEl = document.getElementById("sort");

let allProduk = [];

function affiliateImage(url){
  return `https://api.microlink.io/?url=${encodeURIComponent(url)}&embed=image.url&meta=false&screenshot=false`;
}

async function loadProduk(){
  const q = sortEl.value==="terlaris"?query(collection(db,"produk"),orderBy("klik","desc")):query(collection(db,"produk"),orderBy("createdAt","desc"));
  const snap = await getDocs(q);
  allProduk = snap.docs.map(d=>({id:d.id,...d.data()}));
  renderProduk();
}

function renderProduk(){
  const keyword = searchEl.value.toLowerCase();
  const kategoriMap = {skincare:[],fashion:[],home:[]};
  allProduk.filter(p=>p.nama?.toLowerCase().includes(keyword)).forEach(p=>kategoriMap[p.kategori]?.push(p));
  produkEl.innerHTML="";
  Object.entries(kategoriMap).forEach(([key,items])=>{
    if(items.length===0) return;
    const section=document.createElement("details");
    section.open=true;
    section.className="mb-8";
    section.innerHTML=`<summary class="cursor-pointer font-bold text-xl text-pink-600 mb-4">${key.toUpperCase()} (${items.length})</summary><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-5"></div>`;
    const grid = section.querySelector("div");
    items.forEach(p=>{
      const imgSrc = p.gambar||affiliateImage(p.link);
      const card=document.createElement("div");
      card.className="bg-white rounded-2xl shadow hover:shadow-lg transition p-4";
      card.innerHTML=`<div class="mb-3 rounded-xl overflow-hidden"><img src="${imgSrc}" class="w-full h-44 object-cover" onerror="this.src='https://via.placeholder.com/400x400/ffe4e6/ec4899?text=Luqqy+Store'"/></div>
        <h3 class="font-bold text-pink-700">${p.nama}</h3>
        <p class="text-sm text-gray-500 mb-4">${p.deskripsi||""}</p>
        <a href="${p.link}" target="_blank" class="block text-center bg-pink-400 hover:bg-pink-500 text-white py-2 rounded-full font-semibold" onclick="klikProduk('${p.id}')">ğŸ›ï¸ Beli Sekarang</a>`;
      grid.appendChild(card);
    });
    produkEl.appendChild(section);
  });
}

window.klikProduk = async id => { try{ await updateDoc(doc(db,"produk",id),{klik:increment(1)}); }catch(e){console.warn(e);} };

searchEl.addEventListener("input",renderProduk);
sortEl.addEventListener("change",loadProduk);

loadProduk();
</script>
</body>
</html>
